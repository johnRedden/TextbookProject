<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags always come first -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">

    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <!-- JQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>

    <style type="text/css">
        body{
            font-size:large;
            line-height: 1.5;
            font-family: 'Merriweather', Georgia, 'Times New Roman', Times, serif;
        }
        .marginTop{
            margin-top:75px;
        }
        .navbar { 
             box-shadow: 0px 5px 3px -3px #888;
        }

        .dropdown {
            position: relative;
            display: inline-block;
            vertical-align: middle;
        }

        .list-group.list-group-root {
            padding: 0;
            overflow: hidden;
        }

        .list-group.list-group-root .list-group {
            margin-bottom: 0;
        }

        .list-group.list-group-root .list-group-item {
            border-radius: 0;
            border-width: 1px 0 0 0;
        }

        .list-group.list-group-root > .list-group-item:first-child {
            border-top-width: 0;
        }

        .list-group.list-group-root > .list-group > .list-group-item {
            padding-left: 30px;
        }

        .list-group.list-group-root > .list-group > .list-group > .list-group-item {
            padding-left: 45px;
        }

        .list-group-item .glyphicon {
            margin-right: 5px;
        }
        .list-group-item-heading{
            padding:5px;
        }
    </style>
  </head>

  <body>

    <nav class="navbar navbar-default navbar-static-top">
      <div class="container-fluid">
        <div class="navbar-header">
          <a class="navbar-text" href="/"><img class="pull-left" src="/public/images/eduNetSystems-logo.png"/> 
            <strong> &nbsp eduNetSystems Textbook System Î±</strong></a>
             
        </div>
        <ul class="nav navbar-nav">
          <li class="active"><a href="\">Catalogs</a></li>
          <li><a href="#">About</a></li>
        </ul>
        <ul class="nav navbar-nav navbar-right">
          <li><a href="/login"><span class="glyphicon glyphicon-log-in"></span> Login</a></li>
        </ul>
      </div>
    </nav>

    <div class="container">
        
        <p><em>This is a pre-alpha version of our Online Textbook System.</em></p>
        <div class="list-group list-group-root well">
            <div class="list-group-item-heading">Catalogs</div>
        </div>
    </div>

    <footer class="text-center">
        <div class="well">
            <div class="container">
                <div class="row">
                    <div class="col-xs-12">
                        <div><span class="glyphicon glyphicon-copyright-mark"></span> 2015 <a href="http://www.edunetsystems.com/">eduNetSystems.com</a></div>
                    </div>
                </div>

            </div>
        </div>
    </footer>

    <script type="text/JavaScript">

        $(document).ready(function(){

            $.get("/api/catalogs.json",function(data, status){
                j = $.parseJSON(data);
                console.log(j);
                $.each( j.results, function( key, val ){
                   
                    var htmlBlock = '<a href="#'+val.ID+'" class="list-group-item" data-toggle="collapse">\
                                    <i class="glyphicon glyphicon-chevron-right"></i>'+val.Name+'</a>\
                                    <div class="list-group collapse" id="'+val.ID+'"></div>';

                    $('.list-group-root').append(htmlBlock);

                    $.get('/api/books.json?Catalog='+val.ID,function(data, status){
                        k = $.parseJSON(data);
                        
                        $.each( k.results, function( key, arg ){
                           
                        var htmlBlock2 = '<a href="/toc.html?ID='+arg.ID+'" class="list-group-item" >\
                                        <i class="glyphicon glyphicon-new-window"></i>Book: '+arg.Title+'</a>\
                                        <div class="list-group collapse" id="'+arg.ID+'">\
                                        </div>';

                            $('#'+val.ID).append(htmlBlock2);

                        });
                        //append Book button at end of level 2 list  *********************
                        var addBookBlock = '<div class="input-group">\
                                    <input type="text" class="form-control" placeholder="Add Book."/>\
                                    <span class="input-group-btn">\
                                        <button id="book'+val.ID+'" class="btn btn-warning" type="button">Add Book</button>\
                                    </span>\
                                    </div>';

                        $('#'+val.ID).append('<div class="list-group-item">'+addBookBlock+'</div>');
                        $('#book'+val.ID).on('click',function(){
                            var newBook =  $(this).closest('div').find('input').val(); //hackery i'll tell you!
                            //console.log(newBook);
                            
                            $.post("/api/makeBook",{CatalogName:val.ID,BookName:newBook},function(data){
                               g = $.parseJSON(data);
                               console.log(g.result +":"+ g.reason);
                               location.reload();
                            });
                   
                        });

                    });
                    
                });

                //add Catalog button at end of level 1 list  *********************
                var addCatBlock = '<div class="input-group">\
                        <input type="text" id="catInput" class="form-control" placeholder="Add Catalog."/>\
                        <span class="input-group-btn">\
                            <button id="catBtn" class="btn btn-success" type="button">Add Catalog</button>\
                        </span>\
                        </div>';

                $('.list-group-root').append('<div class="list-group-item">'+addCatBlock+'</div>');


                $('#catBtn').on('click',function(){
                    var newCat =  $('#catInput').val(); //hackery i'll tell you!
                    console.log(newCat);

                    $.post("/api/makeCatalog",{CatalogName:newCat},function(data){
                       g = $.parseJSON(data);
                       console.log(g.result +":"+ g.reason);
                       location.reload();
                    });
                   
                });

                //*********************************************
                // toggle chevrons
                $('.list-group-item').on('click', function() {
                
                        $('.glyphicon', this)
                            .toggleClass('glyphicon-chevron-right')
                            .toggleClass('glyphicon-chevron-down');
                });


            });


        });
        

    </script>
  </body>
</html>

