<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Textbook Project</title>

    <!-- Bootstrap -->
    <link href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet">

    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js" type="text/javascript"></script>
    <script src="http://cdn.ckeditor.com/4.5.3/full-all/ckeditor.js"></script>

    <script type="text/javascript" async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script>
    <style>
    	body {
            font-size: larger;
            background-color: oldlace;
    	}
        textarea{
        	width:100%;
        	height:100px;
            padding:5px;
        }
        .navbar { 
             box-shadow: 0px 5px 3px -3px #888;
             background-color: oldlace;
        }
        .good {
            color: lightblue;
        }
        .bad {
            color: lightpink;
        }
        .goodBack{
              background-color: lightblue;
        }
        .badBack{
              background-color: lightpink;
        }
        #myContainer{
            margin-top: 200px;
        }
    </style>
</head>
<body>

    <nav class="navbar navbar-default navbar-fixed-top">
        <div class="container"> 
            <div class="navbar-header">              
              <h2><img class="pull-left" src="/public/images/eduNetSystems-logo.png"/> &nbsp EduNetSystems Editor </h2>
                <div class="input-group">
                    <label class="input-group-addon">Objective:</label>
                    <input type="text" class="form-control" id="objectiveInput" placeholder="Objective">
                </div>
                <div class="input-group">
                    <label class="input-group-addon">Author:</label>
                    <input type="text" class="form-control" id="authorInput" placeholder="Author">
                </div>
                <div class="input-group">
                    <label class="input-group-addon">Version:</label>
                      <input type="text" class="form-control" id="versionInput" placeholder="Version">
                      <span class="input-group-addon">
                        <span id="glyph" class="glyphicon glyphicon-saved good"> </span>
                      </span>
                      <span class="input-group-btn">
                        <button type="button" class="btn btn-default" id="previewBtn">Preview</button>
                      </span>
                </div>    
                <p><em>online editor alpha version</em></p>
            </div>
        </div>
    </nav>

	
	<div class="container" id="myContainer">

        <form class="well goodBack">
            <strong>Content:</strong>
            <textarea name="Message" id="editor1" cols="10" wrap="hard" autofocus placeholder="Enter new message."></textarea>
        </form>
        <form class="well goodBack">
            <strong>Key Takeaways:</strong>
            <textarea name="Message2" id="editor2"  wrap="hard" placeholder="KeyTakeaways"></textarea>
        </form>
    </div>

    <footer class="text-center">
        <div class="well">
            <div class="container">
                <div class="row">
                    <div class="col-xs-12">

                        <div><span class="glyphicon glyphicon-sunglasses"></span>2015 eduNetSystems.com</div>

                    </div>
                </div>

            </div>
        </div>
    </footer>


    <script>
        $(document).ready(function () {
            //fake initial data
            var objStr = "Adding and subtracting fractions.";
            var verStr = "1.5";
            var authStr = "John Redden";
            //populate input boxes
            $("#objectiveInput").val(objStr);
            $("#authorInput").val(authStr);
            $("#versionInput").val(verStr);


            
            //ckeditor setup - two instances ***********************************
            var ed = CKEDITOR.replace( 'editor1', {
                extraPlugins: 'mathjax',
                mathJaxLib: 'http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML'
              } );
            var ed2 = CKEDITOR.replace( 'editor2', {
                extraPlugins: 'mathjax',
                mathJaxLib: 'http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML'
              } );

            ed.on("instanceReady", function(event){
                //resize to fit div  width, height // put stored data in ckEditor
                this.resize("100%",600);
                // put stored data into ckeditor
                //this.insertHtml( {{.Data}} );
                // maybe an ajax call here to do this??
                this.focus();
                // Handle when the HTML changes.
                this.on('change', function () {
                    //styling for visual change
                    $('#glyph').removeClass('good glyphicon-saved').addClass('bad glyphicon-save');
                    $('.well').each(function( index ) {
                         $( this ).removeClass('goodBack').addClass('badBack');
                    });

                });
                // overrides default save behavor (super easy)
                this.getCommand('save').exec = function(editor) { 
                    saveData();
                };

            });
            ed2.on("instanceReady", function(event){
                this.on('change', function () {
                    $('#glyph').removeClass('good glyphicon-saved').addClass('bad glyphicon-save');
                    $('.well').each(function( index ) {
                         $( this ).removeClass('goodBack').addClass('badBack');
                    });
                });
                // overrides default save behavor (super easy)
                this.getCommand('save').exec = function(editor) { 
                    saveData();
                };

            });
            //*************************************************

            $("#previewBtn").click(function(){
                console.log("clicked previewBtn");
                // open page with content here maybe a popout.
                window.open('/preview', '_blank'); 

            });

            //regular javascript function to be resused.
            function saveData(){
                var a = $('#objectiveInput').val();
                var b = $('#authorInput').val();
                var c = $('#versionInput').val();
                var d = CKEDITOR.instances['editor1'].getData();
                var e = CKEDITOR.instances['editor2'].getData();
                
                // can post multiple paramaters via post using JSON below
                $.post("postData", {objective: a, author: b, version:c, content: d, keytakeaways: e}, function(data, status){
                    console.log("Data: " + data + "\nStatus: " + status);
                    // need to figure out Ajax solution here
                    //location.reload();
                    if(status==="success"){
                        $('#glyph').removeClass('bad glyphicon-save').addClass('good glyphicon-saved');
                        $('.well').each(function( index ) {
                            $( this ).removeClass('badBack').addClass('goodBack');
                        });
                    }
                });

            };

   
        });
        
    </script>

</body>
</html>