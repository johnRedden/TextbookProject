<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Textbook Project</title>

        <!-- Bootstrap -->
    <link href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet">

    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js" type="text/javascript"></script>
    <script src="http://cdn.ckeditor.com/4.5.3/full-all/ckeditor.js"></script>

    <script type="text/javascript" async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script>
    <style>
    	body {
    		text-align: center;
            font-size: larger;
    	}
        textarea{
        	width:100%;
        	height:100px;
            padding:5px;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
      
      <div class="row well">
        <div class="col-sm-8">
          <h2><img src="/public/images/eduNetSystems-logo.png">EduNetSystems Editor</h2>
        </div>
        <div class="col-sm-4">
            <div class="btn-group">
                <button type="button" class="btn btn-primary" id="saveBtn">Save</button>
                <button type="button" class="btn btn-danger" id="previewBtn">Preview</button>
            </div>
        </div>
      </div>
    </div>
	
	<div class="container" id="myContainer">

        <form>
            <textarea name="Message" id="editor1" cols="10" wrap="hard" autofocus placeholder="Enter new message."></textarea>
        </form>
    </div>

    <script>
        $(document).ready(function () {
            
            //ckeditor setup ***********************************
            var ed = CKEDITOR.replace( 'editor1', {
                extraPlugins: 'mathjax',
                mathJaxLib: 'http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML'
              } );

            ed.on("instanceReady", function(event){
                //resize to fit div  width, height // put stored data in ckEditor
                this.resize("100%",600);
                // put stored data into ckeditor
                //this.insertHtml( {{.Data}} );
                // maybe an ajax call here to do this??
                this.focus();
                // Handle when the HTML changes.
                this.on('change', function () {
                    $('#previewBtn').removeClass('btn-success').addClass('btn-danger');

                });
                this.on('save', function () {
                    alert("save btn clicked");
                    //saveData();

                });
                
            });
            //*************************************************
            
   
            $("#saveBtn").click(function(){

                console.log("click btn");
                saveData();
 


                //TODO: if textarea changes change status to not saved.  eZ

            });

            $("#previewBtn").click(function(){
                console.log("clicked previewBtn");
                // open page with content here maybe a popout.
                window.open('/preview', '_blank'); 

            });

            function saveData(){

                var x = CKEDITOR.instances['editor1'].getData();
                console.log(x);
                // can post multiple paramaters via post using JSON below
                $.post("postData", {BookName: "Something", content: x}, function(data, status){
                    console.log("Data: " + data + "\nStatus: " + status);
                    // need to figure out Ajax solution here
                    //location.reload();
                    if(status==="success"){
                        $("#statusDialog").html("saved!")
                        $('#previewBtn').removeClass('btn-danger').addClass('btn-success');
                    }
                });

            };

   
        });
        
    </script>

</body>
</html>